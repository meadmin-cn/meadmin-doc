import{_ as s,o as n,c as e,ai as p}from"./chunks/framework.BdTV7y8C.js";const m=JSON.parse('{"title":"介绍","description":"","frontmatter":{},"headers":[],"relativePath":"server/guide.md","filePath":"server/guide.md"}'),i={name:"server/guide.md"};function l(r,a,c,o,t,d){return n(),e("div",null,[...a[0]||(a[0]=[p(`<h1 id="介绍" tabindex="-1">介绍 <a class="header-anchor" href="#介绍" aria-label="Permalink to “介绍”">​</a></h1><p>后端使用Midway框架，Midway 是阿里巴巴 - 淘宝前端架构团队，基于渐进式理念研发的 Node.js 框架，通过自研的依赖注入容器，搭配各种上层模块，组合出适用于不同场景的解决方案。 如需对后端进行更多了解，可阅读<a href="https://midwayjs.org/docs/intro" target="_blank" rel="noreferrer">midway文档</a></p><h2 id="目录结构" tabindex="-1">目录结构 <a class="header-anchor" href="#目录结构" aria-label="Permalink to “目录结构”">​</a></h2><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>├──.husky git hooks钩子文件夹</span></span>
<span class="line"><span>├──.vscode vscode推荐配置文件夹</span></span>
<span class="line"><span>├── dist 后端打包文件夹</span></span>
<span class="line"><span>├──logs 日志文件夹</span></span>
<span class="line"><span>├──public 静态资源文件</span></span>
<span class="line"><span>│   ├── admin 后台静态资源</span></span>
<span class="line"><span>│   ├── index 前台静态资源</span></span>
<span class="line"><span>├── src  后端主目录</span></span>
<span class="line"><span>│   ├── app 后端模块根目录</span></span>
<span class="line"><span>│   │   ├──admin 后台接口模块</span></span>
<span class="line"><span>│   │   │   ├── controller 模块控制器文件夹</span></span>
<span class="line"><span>│   │   │   ├── dto 模块出入参dto类文件夹</span></span>
<span class="line"><span>│   │   │   ├── middleware 模块中间件夹</span></span>
<span class="line"><span>│   │   │   └── service 模块service文件夹</span></span>
<span class="line"><span>│   │   ├──index 前台接口模块</span></span>
<span class="line"><span>│   │   │   ├── controller 模块控制器文件夹</span></span>
<span class="line"><span>│   │   │   ├── dto 模块出入参dto类文件夹</span></span>
<span class="line"><span>│   │   │   ├── middleware 模块中间件夹</span></span>
<span class="line"><span>│   │   │   └── service 模块service文件夹</span></span>
<span class="line"><span>│   │   └──home.controller.ts 页面渲染控制器</span></span>
<span class="line"><span>│   ├── config 配置文件夹</span></span>
<span class="line"><span>│   ├── controller 公共控制器文件夹</span></span>
<span class="line"><span>│   ├── decorators 装饰器文件夹</span></span>
<span class="line"><span>│   ├── dict 字典文件夹</span></span>
<span class="line"><span>│   ├── dto 出入参dto基类文件夹</span></span>
<span class="line"><span>│   ├── entities 数据库实体类文件夹</span></span>
<span class="line"><span>│   ├── fileManage 文件夹管理助手类</span></span>
<span class="line"><span>│   ├── filter 异常类文件夹</span></span>
<span class="line"><span>│   ├── helper 助手函数文件夹</span></span>
<span class="line"><span>│   ├── locales 后端多语言文件包</span></span>
<span class="line"><span>│   ├── response 反参基类</span></span>
<span class="line"><span>|   ├── ruleType 后端自定义校验规则</span></span>
<span class="line"><span>|   ├── service 全局公共service</span></span>
<span class="line"><span>|   ├── types 类型扩展</span></span>
<span class="line"><span>|   ├── configuration.ts 启动文件</span></span>
<span class="line"><span>│   └── logger.ts logger初始化文件</span></span>
<span class="line"><span>├── uploadFile 本地上传目录</span></span>
<span class="line"><span>├── view 前端文件夹</span></span>
<span class="line"><span>├── .env env环境变量，VIEW_ADMIN_开头的可被 前端admin项目获取到，VIEW_INDEX_开头的可被前端 index项目获取到</span></span>
<span class="line"><span>├── .env.prod 启动后env环境变量</span></span>
<span class="line"><span>├── .eslintrc.json eslint配置文件</span></span>
<span class="line"><span>├── .gitignore git 忽略文件</span></span>
<span class="line"><span>├── .npmrc pnpm配置文件</span></span>
<span class="line"><span>├── .prettierignore prettier忽略文件</span></span>
<span class="line"><span>├── .prettierrc.cjs prettier配置文件</span></span>
<span class="line"><span>├── bootstrap.js 部署后bootstrap启动文件</span></span>
<span class="line"><span>├── meadmin.sql 初始化sql文件</span></span>
<span class="line"><span>├── pnpm-workspace.yaml pnpm workspace 配置</span></span>
<span class="line"><span>└── tsconfig.json typescript配置文件</span></span></code></pre></div><h2 id="基本概念" tabindex="-1">基本概念 <a class="header-anchor" href="#基本概念" aria-label="Permalink to “基本概念”">​</a></h2><p>后端基于 Node.js 监听端口，对外主要提供 API 接口及页面访问。</p><p>后端架构主要划分为以下几层：router、controller、service、dto、entity。</p><ul><li><p>router：定义路由映射，将不同请求指向对应 controller 类中的方法。访问相应地址时会自动触发对应的 controller 逻辑。</p></li><li><p>controller：作为请求入口，负责入参校验、调用 service、返回响应，并集成 Swagger 生成接口文档。其中可能封装少量控制逻辑，但核心业务处理一般交由 service。</p></li><li><p>service：封装核心业务逻辑，根据场景组织代码。通过 entity 数据模型进行数据库操作，并实现复杂业务处理。</p></li><li><p>entity：对应数据库表的模型实体，所有数据库操作均通过 entity 完成。</p></li><li><p>dto：定义接口的请求参数与响应结果格式。每个接口都有对应的 DTO 类，controller 在接收到请求时会自动基于 DTO 完成参数校验。</p></li></ul><h2 id="改动及封装" tabindex="-1">改动及封装 <a class="header-anchor" href="#改动及封装" aria-label="Permalink to “改动及封装”">​</a></h2><p>本项目对midway做了以下封装，详情请参考相关章节。</p><h3 id="controller装饰器会继承prefix和routeroptions。" tabindex="-1">controller装饰器会继承prefix和routerOptions。 <a class="header-anchor" href="#controller装饰器会继承prefix和routeroptions。" aria-label="Permalink to “controller装饰器会继承prefix和routerOptions。”">​</a></h3><p>根据 controller 继承关系 递归合成Controller装饰器的参数 从第一个prefix以/开头的祖级开始合并controller的prefix和routerOptions，如果prefix 以/开头，则不合并prefix和routerOptions</p><h3 id="强制文件目录结构" tabindex="-1">强制文件目录结构 <a class="header-anchor" href="#强制文件目录结构" aria-label="Permalink to “强制文件目录结构”">​</a></h3><p>Midway 对目录没有特别的限制，但当前项目，将一部分常用的文件进行归类，放到一些默认的文件夹中。文件夹详情请参考<a href="#目录结构">目录结构</a>。日常开发需要关注的主要有：<code>src/app/*/controller</code>文件、<code>src/app/*/service</code>文件、<code>src/app/*/dto</code>文件、<code>src/app/*/middleware</code>中间件文件、<code>src/entities</code>数据库实体类文件。</p><h3 id="模块" tabindex="-1">模块 <a class="header-anchor" href="#模块" aria-label="Permalink to “模块”">​</a></h3><p>本项目增加了模块的概念，在<code>src/app/</code>下每一个文件夹代表一个模块，将相关逻辑归类存放。</p><h3 id="应用" tabindex="-1">应用 <a class="header-anchor" href="#应用" aria-label="Permalink to “应用”">​</a></h3><p>应用基于koa 使用<code>@midwayjs/koa</code>组件</p><h3 id="参数校验" tabindex="-1">参数校验 <a class="header-anchor" href="#参数校验" aria-label="Permalink to “参数校验”">​</a></h3><p>已集成，源于<code>joi</code>的<code>@midwayjs/validate@3</code>参数校验组件，并自定义了<code>mobile</code>等校验规则</p><h3 id="多语言" tabindex="-1">多语言 <a class="header-anchor" href="#多语言" aria-label="Permalink to “多语言”">​</a></h3><p>已集成<code>@midwayjs/i18n@3</code>多语言组件，多语言文件夹为<code>locales/en.json</code>，并且翻译失败使用当前key做为返回值</p><h3 id="数据库访问" tabindex="-1">数据库访问 <a class="header-anchor" href="#数据库访问" aria-label="Permalink to “数据库访问”">​</a></h3><p>已集成sequelize7，自定义封装的sequelize访问service，相关源码在<code>src/service/dataSourceManager.service.ts</code>,对应配置文件在<code>src/config/database.ts</code></p><h3 id="静态文件映射" tabindex="-1">静态文件映射 <a class="header-anchor" href="#静态文件映射" aria-label="Permalink to “静态文件映射”">​</a></h3><p>集成 <code>@midwayjs/static-file@3</code>组件，<code>public</code>文件夹下的资源都可以使用<code>/文件名</code>直接访问</p><h3 id="模板引擎" tabindex="-1">模板引擎 <a class="header-anchor" href="#模板引擎" aria-label="Permalink to “模板引擎”">​</a></h3><p>集成 <code>@medamin/midway-vite-view</code>组件，实现vite+vue模板渲染支持</p><h3 id="缓存" tabindex="-1">缓存 <a class="header-anchor" href="#缓存" aria-label="Permalink to “缓存”">​</a></h3><p>集成<code>@midwayjs/redis@3</code>和<code>@midwayjs/cache-manager@3</code>组件，实现基于redis的缓存支持</p><h3 id="日志" tabindex="-1">日志 <a class="header-anchor" href="#日志" aria-label="Permalink to “日志”">​</a></h3><p>调试模式及部署模式，都将日志目录改为本地的 \${app.appDir}/logs/ 目录下</p>`,32)])])}const b=s(i,[["render",l]]);export{m as __pageData,b as default};
